
{% extends "base.html" %}

{% block title %}비문학 모의고사 결과 - 한국 학습 플랫폼{% endblock %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex align-items-center mb-3">
                <a href="{{ url_for('korean_nonfiction') }}" class="btn btn-outline-secondary me-3">
                    <i class="fas fa-arrow-left me-2"></i>목록으로
                </a>
                <div>
                    <h2><i class="fas fa-chart-line me-2"></i>{{ test_data.title }} - 결과</h2>
                    <p class="text-muted mb-0">모의고사 결과를 확인하세요.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 점수 요약 -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-success">
                <div class="card-body text-center">
                    <div class="row">
                        <div class="col-md-3">
                            <h3 class="text-success mb-1">{{ result_data.score }}점</h3>
                            <small class="text-muted">총점</small>
                        </div>
                        <div class="col-md-3">
                            <h3 class="text-primary mb-1">{{ correct_count }}/{{ test_data.question_count }}</h3>
                            <small class="text-muted">정답 수</small>
                        </div>
                        <div class="col-md-3">
                            <h3 class="text-warning mb-1">{{ result_data.duration }}분</h3>
                            <small class="text-muted">소요 시간</small>
                        </div>
                        <div class="col-md-3">
                            <h3 class="text-info mb-1">
                                {% if result_data.score >= 80 %}A
                                {% elif result_data.score >= 70 %}B
                                {% elif result_data.score >= 60 %}C
                                {% elif result_data.score >= 50 %}D
                                {% else %}F
                                {% endif %}
                            </h3>
                            <small class="text-muted">등급</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 문제별 결과 -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-list-check me-2"></i>문제별 결과
                    </h5>
                </div>
                <div class="card-body">
                    {% for i in range(test_data.question_count) %}
                    {% set question = test_data.questions[i] %}
                    {% set user_answer = result_data.answers.get(loop.index|string, 0) %}
                    {% set is_correct = user_answer == question.correct_answer %}
                    
                    <div class="question-result mb-4 p-3 border rounded {{ 'border-success bg-light' if is_correct else 'border-danger' }}">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <h6 class="text-{{ 'success' if is_correct else 'danger' }}">
                                문제 {{ loop.index }}번
                                <i class="fas fa-{{ 'check-circle' if is_correct else 'times-circle' }} ms-2"></i>
                            </h6>
                            <div class="text-end">
                                <div class="mb-1">
                                    <small class="text-muted">내 답:</small>
                                    <span class="badge bg-{{ 'success' if is_correct else 'danger' }}">
                                        {{ user_answer }}번
                                    </span>
                                </div>
                                {% if not is_correct %}
                                <div>
                                    <small class="text-muted">정답:</small>
                                    <span class="badge bg-success">{{ question.correct_answer }}번</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="question-content mb-3">
                            {{ question.content|safe }}
                        </div>
                        
                        <div class="options">
                            {% for j in range(5) %}
                            {% set option_num = j + 1 %}
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" disabled
                                       {% if option_num == user_answer %}checked{% endif %}>
                                <label class="form-check-label">
                                    <span class="me-2
                                        {% if option_num == question.correct_answer %}text-success fw-bold
                                        {% elif option_num == user_answer and not is_correct %}text-danger
                                        {% endif %}">
                                        {{ '①②③④⑤'[j] }}
                                    </span>
                                    {{ question.options[j]|safe }}
                                    {% if option_num == question.correct_answer %}
                                        <i class="fas fa-check text-success ms-2"></i>
                                    {% elif option_num == user_answer and not is_correct %}
                                        <i class="fas fa-times text-danger ms-2"></i>
                                    {% endif %}
                                </label>
                            </div>
                            {% endfor %}
                        </div>
                        
                        {% if question.explanation %}
                        <div class="mt-3 p-3 bg-light border-start border-5 border-info">
                            <h6 class="text-info mb-2">
                                <i class="fas fa-lightbulb me-2"></i>해설
                            </h6>
                            <p class="mb-0">{{ question.explanation|safe }}</p>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- 다시 풀기 버튼 -->
    <div class="row mt-4">
        <div class="col-12 text-center">
            <div class="d-flex gap-2 justify-content-center">
                <a href="{{ url_for('korean_nonfiction_test', test_id=test_data.id) }}" class="btn btn-primary">
                    <i class="fas fa-redo me-2"></i>다시 풀기
                </a>
                <a href="{{ url_for('korean_nonfiction') }}" class="btn btn-outline-secondary">
                    <i class="fas fa-list me-2"></i>다른 문제 풀기
                </a>
                <a href="{{ url_for('korean_nonfiction_results') }}" class="btn btn-outline-info">
                    <i class="fas fa-chart-line me-2"></i>성적 기록
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// 이미지 로드 오류 처리
document.addEventListener('DOMContentLoaded', function() {
    const images = document.querySelectorAll('img');
    images.forEach(img => {
        img.addEventListener('error', function() {
            this.style.display = 'none';
            this.insertAdjacentHTML('afterend', '<div class="alert alert-warning">이미지를 불러올 수 없습니다.</div>');
        });
    });
});
</script>
{% endblock %}
